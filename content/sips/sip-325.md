---
sip: 325
title: Cross-chain Election Module (V3GM)
network: Ethereum & Optimism
status: Draft
proposal: >-
  https://snapshot.org/#/snxgov.eth/proposal/0x
type: Governance
author: MEB (@barrasso), Noah Litvin (@noahlitvin)
implementor: N/A
created: 2023-08-25
---

<!--You can leave these HTML comments in your merged SIP and delete the visible duplicate text guides, they will not appear and may be helpful to refer to if you edit it again. This is the suggested template for new SIPs. Note that an SIP number will be assigned by an editor. When opening a pull request to submit your SIP, please use an abbreviated title in the filename, `sip-draft_title_abbrev.md`. The title should be 44 characters or less.-->

## Simple Summary

<!--"If you can't explain it simply, you don't understand it well enough." Simply describe the outcome the proposed changes intends to achieve. This should be non-technical and accessible to a casual community member.-->

This SIP adds cross-chain functionality to the elections system.

## Abstract

<!--A short (~200 word) description of the proposed change, the abstract should clearly describe the proposed change. This is what *will* be done if the SIP is implemented, not *why* it should be done or *how* it will be done. If the SIP proposes deploying a new contract, write, "we propose to deploy a new contract that will do x".-->

The proposal aims to extend the existing `ElectionModule`, originally introduced in [SIP-207](https://sips.synthetix.io/sips/sip-207/), to include cross-chain governance capabilities. Upon approval, the elections system will be upgraded to facilitate election processes across all networks on which Synthetix is deployed, including Ethereum and Optimism. The upgrade will utilize the CCIP integration, which was initially implemented in [SIP-311](https://sips.synthetix.io/sips/sip-311/), to manage cross-chain messaging for governance activities.

## Motivation

<!--This is the problem statement. This is the *why* of the SIP. It should clearly explain *why* the current state of the protocol is inadequate.  It is critical that you explain *why* the change is needed, if the SIP proposes changing how something is calculated, you must address *why* the current calculation is inaccurate or wrong. This is not the place to describe how the SIP will address the issue!-->

As the Synthetix protocol continues its expansion across multiple networks, a more efficient governance system that enables participation across many networks becomes increasingly crucial. Therefore, the current election system should be upgraded as it lacks a scalable solution for cross-chain messaging. The proposed module will ensure that Synthetix can accommodate a wide range of networks while maintaining the integrity of its governance framework. This will improve the user experience by allowing stakers to participate in elections on their preferred networks.

## Specification

<!--The specification should describe the syntax and semantics of any new feature, there are five sections
1. Overview
2. Rationale
3. Technical Specification
4. Test Cases
5. Configurable Values
-->

### Overview

<!--This is a high level overview of *how* the SIP will solve the problem. The overview should clearly describe how the new feature will be implemented.-->

The proposed changes to the `ElectionModule` will enable the election processes (voting, evaluation, and election resolution) to function across all supported networks in a modular and efficient way.

### Rationale

<!--This is where you explain the reasoning behind how you propose to solve the problem. Why did you propose to implement the change in this way, what were the considerations and trade-offs. The rationale fleshes out what motivated the design and why particular design decisions were made. It should describe alternate designs that were considered and related work. The rationale may also provide evidence of consensus within the community, and should discuss important objections or concerns raised during discussion.-->

Several key considerations have shaped the design and approach of this SIP as described below:

**Cross-chain Communication**

Leveraging CCIP for cross-chain governance was a strategic decision based on its proven reliability and efficiency. CCIP introduces no additional trust assumptions and offers a standardized mechanism for transmitting messages across chains. Additionally, it allows for the reuse of existing code developed for snxUSD Teleporters, which contributes to the robustness and speed of implementation for this new module.

**Mothership Pattern**
The concept of recording and tabulating votes on a single "mothership" chain was chosen to minimize complexity and maintain governance integrity. Having multiple chains responsible for these processes would increase the risk of inconsistencies and errors. Optimism was selected as the mothership chain since it is already functioning as the primary deployment for the existing elections system (V3GM).

**Voting Power Consideration**
The proposal also accounts for the calculation of both v2x and v3 voting power. This is particularly important in the context of Synthetix's progressive migration plan to shift liquidity from v2x to v3. By incorporating this in the calculation, the new module ensures that all token holders, regardless of their version, are fairly represented in the governance process.

Alternative designs were considered but were either less efficient or added complexity. Preliminary community discussions indicate broad consensus for this approach, and key concerns regarding election integrity have been addressed.

### Technical Specification

<!--The technical specification should outline the public API of the changes proposed. That is, changes to any of the interfaces Synthetix currently exposes or the creations of new ones.-->

The elections system code has been designed such that the same codebase can be deployed to every chain. Only one deployment can be configured as the “mothership", which in this case is Optimism. The mothership receives information pertaining to all the votes via cross-chain messages and tallies up the results. Once the voting period is over, the mothership chain broadcasts a cross-chain message containing the winner data to make sure that the council member NFTs are burned/minted appropriately on each chain.

The implementation entails adding two new cross-chain "recv" counterpart functions to the election module that handle voting and resolution. This is similar to how the Teleporters implementation works with its "send/recv" pattern.

Casting a vote will `transmit` the vote data to the mothership chain to be tabulated.

    function cast(
        address[] calldata candidates,
        uint256[] calldata amounts
    ) public virtual override

    function _recvCast(
        address voter,
        uint256 precinct,
        Ballot.Data calldata ballot
    ) external

_Note that `_recvCast` function should only be callable by the proxy contract on the mothership chain._

Resolving elections can only occur on the mothership chain. Once completed, a message containing the election results will be broadcast to all networks. Once received, the council NFTs will be distributed appropriately on each chain (handled in `_recvResolve`).

    function resolve() public virtual override onlyMothership

    function _recvResolve(address[] calldata winners, uint256 newEpochIndex) external

### Epoch Periods

As in the current election system, there are four “periods” within each epoch:

- **Administration Period** - No election is under way.
- **Nomination Period** - Nearing the end of the epoch, addresses may be nominated for election.
- **Voting Period** - After the nomination period, addresses with voting power may assign votes to nominees.
- **Evaluation Period** - Finally, voting closes and the winners are calculated. The existing NFTs are burned and new council member NFTs are minted to the winners on each chain. The NFTs will interface directly with the governor module on-chain.

### Voting Strategy

In the interest of reducing complexity, this SIP will inherit most of the same strategy implemented for V3GM in [SIP-207](https://sips.synthetix.io/sips/sip-207/#implementation-of-voting-strategies). This means, the following considerations are taken for the Voting Strategy:

- **Ballot Configuration**: The implementation supports one candidate per vote, applying the voting power to it. Voters can change the candidate voted.
- **Voting Power**: A user's combined voting power from the v2x and v3 systems is snapshotted at the beginning of an epoch using the `SnapShotVotePowerModule`.
- **Voting Weight**: Linear. 1 debt unit or 1 SNX delegated = 1 vote.
- **Vote Counting**: The strategy to implement is _Plurality_. The Voting Power received from voters is added to the voted candidate(s). The most voted candidates are elected to be the new members.

```
- In the V2 system, voting power is based on the amount of debt shares an address has assumed.
- In the V3 system, voting power is based on the amount of SNX that an account has delegated to the Spartan Council pool.
```

### Test Cases

<!--Test cases for an implementation are mandatory for SIPs but can be included with the implementation..-->

Relevant tests will be developed during implementation including:

Unit Tests

For Voting:

    It reverts transactions coming from an unauthorized address (i.e. non-CCIP address).
    It reverts if the sender does not have voting power.

For Resolution:

    It reverts if caller is not the CcipRouter.
    It reverts if chain is not the mothership.
    It transmits message to specified caller.

Integration Tests

- An integration test to cover the initiation of a cross-chain vote.

  Verify the CcipRouter reports the correct voting power amount on the source chain.
  Verify it refunds the correct amount of left over gas (i.e. difference between msg.value and getFee()) to the caller.
  Verify it correctly invokes CcipRouter.ccipSend() with the expected encoded data.
  Verify it emits a VoteCast event with the expected values.

- An integration test to cover the recording of a cross-chain vote.

  Verify the CcipRouter reports the expected voting power amount.
  Verify it correctly invokes ccipReceive() with the expected encoded data.
  Verify it emits a VoteRecorded event with the expected values.

- An integration test to cover the resolution of an election.

  Verify the CcipRouter reports the expected winner data.
  Verify it correctly invokes ccipReceive() with the expected encoded data.
  Verify it correctly increments the epoch index.

Manual Tests

    Deploy and test on three or more networks using fresh instances of V3.
    Confirm source/destination transactions are correct using the CCIP explorer.
    Confirm the CcipRouter (on destination) emits a MessageExecuted event.
    Confirm goverance actions function as intended during each epoch period.

### Configurable Values (Via SCCP)

<!--Please list all values configurable via SCCP under this implementation.-->

In addition to the following settings, each deployment of Synthetix must be configured with the chain id of the `mothership` (i.e. the first entry in the `CrossChain.supportedNetworks` set). In this case, the `mothership` is set to Optimism (chain id == `10`).

```
    // Number of council members in the current epoch
    uint8 epochSeatCount;

    // Minimum active council members. If too many are dismissed an emergency election is triggered
    uint8 minimumActiveMembers;

    // Expected duration of the epoch
    uint64 epochDuration;

    // Expected nomination period duration
    uint64 nominationPeriodDuration;

    // Expected voting period duration
    uint64 votingPeriodDuration;

    // Maximum size for tweaking epoch schedules (see tweakEpochSchedule)
    uint64 maxDateAdjustmentTolerance;
```

## Copyright

Copyright and related rights waived via [CC0](https://creativecommons.org/publicdomain/zero/1.0/).
